
-- TABLA PACIENTES
CREATE TABLE PACIENTES(
DNI VARCHAR(8) PRIMARY KEY NOT NULL,
NOMBRES VARCHAR2(50) NOT NULL,
APELLIDOS VARCHAR2(50) NOT NULL,
DIRECCION VARCHAR2(50) ,
TELEFONO NUMBER(9) ,
SEGURIDAD_SOCIAL VARCHAR2(30) ,
MUTUALIDAD VARCHAR2(20) 
);

--TABLA DOCTORES
CREATE TABLE DOCTORES(
ID_DOCTORES NUMBER(5)PRIMARY KEY NOT NULL,
DNI VARCHAR(8)NOT NULL,
NOMBRES VARCHAR2(50),
APELLIDOS VARCHAR2(50),
ID_ESPEC NUMBER(5),
LIM_PACIENTE NUMBER(10)
);
-- RELACIONANDO LAS TABLAS(CREACION DE FK)
ALTER TABLE DOCTORES ADD CONSTRAINT FK_ESPECIALIDAD_ID FOREIGN KEY (ID_ESPEC) REFERENCES ESPECIALIDAD(ID_ESPECIALIDAD);

-- TABLA HABITACION
CREATE TABLE HABITACIONES(
ID_HABITACIONES NUMBER(5)PRIMARY KEY NOT NULL,
PLANTA_ID NUMBER(5),
NUMERO NUMBER(2)
);
-- RELACIONANDO TABLAS(FK)
ALTER TABLE HABITACIONES ADD CONSTRAINT FK_ID_PLANTA FOREIGN KEY(PLANTA_ID) REFERENCES PLANTAS(ID_PLANTAS);


-- TABLA ESPECIALIDAD
CREATE TABLE ESPECIALIDAD(
ID_ESPECIALIDAD NUMBER(5) PRIMARY KEY NOT NULL,
NOMBRE_ESP VARCHAR(30)
);

-- TABLA CITAS
CREATE TABLE CITAS(
ID_CITAS NUMBER(5) PRIMARY KEY NOT NULL,
PACIENTE_DNI VARCHAR2(8)NOT NULL,
DOCTOR_ID NUMBER(5)NOT NULL,
URGENCIA VARCHAR2(30),
FECHA_PROGRAMADA DATE ,
FECHA_REGISTRO DATE ,
NUMERO_ORDEN VARCHAR2(30) 
);
-- RELACIONANDO TABLAS(CREACION DE FK)
ALTER TABLE CITAS ADD CONSTRAINT FK_DNI_PACIENTE FOREIGN KEY(PACIENTE_DNI) REFERENCES PACIENTES(DNI);
ALTER TABLE CITAS ADD CONSTRAINT FK_DOCTOR_ID FOREIGN KEY(DOCTOR_ID) REFERENCES DOCTORES(ID_DOCTORES);

-- TABLA OCUPACION
CREATE TABLE OCUPACION(
ID_OCUPACION NUMBER(5)PRIMARY KEY NOT NULL,
CAMA_ID NUMBER(5) NOT NULL,
FECHA_INGRESO DATE ,
FECHA_SALIDA DATE ,
PACIENTE_DNI VARCHAR2(8) NOT NULL
);
-- RELACIONANDO TABLAS
ALTER TABLE OCUPACION ADD CONSTRAINT FK_CAMA_ID FOREIGN KEY(CAMA_ID) REFERENCES CAMAS(ID_CAMAS);
ALTER TABLE OCUPACION ADD CONSTRAINT FK_PACIENTE_DNI FOREIGN KEY(PACIENTE_DNI) REFERENCES PACIENTES(DNI);

-- TABLA DIAS
CREATE TABLE DIAS(
DIA VARCHAR2(10) PRIMARY KEY NOT NULL,
DOCTOR_ID NUMBER(5) NOT NULL,
HORARIO_ID NUMBER(5) NOT NULL
);
--REALCIONANDO TABLAS
ALTER TABLE DIAS ADD CONSTRAINT FK_ID1_MEDICO FOREIGN KEY(DOCTOR_ID) REFERENCES DOCTORES(ID_DOCTORES);
ALTER TABLE DIAS ADD CONSTRAINT FK_HORARIO_ID FOREIGN KEY(HORARIO_ID) REFERENCES HORARIOS(ID_HORARIOS);

-- TABLA HORARIOS
CREATE TABLE HORARIOS(
ID_HORARIOS NUMBER(5)PRIMARY KEY NOT NULL,
HORA_INICIO DATE ,
HORA_FIN DATE 
);

-- TABLA CAMAS
CREATE TABLE CAMAS(
ID_CAMAS NUMBER(5)PRIMARY KEY NOT NULL,
HABITACION_ID NUMBER(5) NOT NULL,
--LETRA VARCHAR2(1) ,
PACIENTE_DNI VARCHAR2(8) 
);
--RELACIONANDO TABLAS(CREANDO FK)
ALTER TABLE CAMAS ADD CONSTRAINT FK_HABITACION_ID FOREIGN KEY(HABITACION_ID) REFERENCES HABITACIONES(ID_HABITACIONES);
ALTER TABLE CAMAS ADD CONSTRAINT FK_PACIENTE_DNI1 FOREIGN KEY(PACIENTE_DNI) REFERENCES PACIENTES(DNI);

-- TABLA PLANTAS
CREATE TABLE PLANTAS(
ID_PLANTAS NUMBER(5) PRIMARY KEY NOT NULL,
NOMBRE VARCHAR2(30),
DIRECCION VARCHAR2(50) 
);

-- TABLA DE PACIENTES INACTIVOS
CREATE TABLE DESHAB_PAC(
DS_DNI VARCHAR(8) PRIMARY KEY NOT NULL,
DS_NOMBRES VARCHAR2(50) NOT NULL,
DS_APELLIDOS VARCHAR2(50) NOT NULL,
DS_DIRECCION VARCHAR2(50),
DS_TELEFONO NUMBER(9),
DS_SEGURIDAD_SOCIAL VARCHAR2(30),
DS_MUTUALIDAD VARCHAR2(20)
);

-- TABLA DE DOCTORES INACTIVOS
CREATE TABLE DESHAB_DOC(
DS_ID_DOCTORES NUMBER(5)PRIMARY KEY NOT NULL,
DS_DNI VARCHAR(8)NOT NULL,
DS_NOMBRES VARCHAR2(50),
DS_APELLIDOS VARCHAR2(50),
DS_ID_ESPEC NUMBER(5),
DS_LIM_PACIENTE NUMBER(10)
)

-- TABLA DE ESPECIALIDADES INACTIVAS
CREATE TABLE DESHAB_ESP(
DS_ID_ESPECIALIDAD NUMBER(5) PRIMARY KEY NOT NULL,
DS_NOMBRE_ESP VARCHAR2(30)
);

-- BORRANDO LAS TABLAS
DROP TABLE PACIENTES CASCADE CONSTRAINTS;
DROP TABLE DOCTORES CASCADE CONSTRAINTS;
DROP TABLE HABITACIONES CASCADE CONSTRAINTS;
DROP TABLE ESPECIALIDAD CASCADE CONSTRAINTS;
DROP TABLE CAMAS CASCADE CONSTRAINTS;
DROP TABLE PLANTAS CASCADE CONSTRAINTS;
DROP TABLE HORARIOS CASCADE CONSTRAINTS;
DROP TABLE DIAS CASCADE CONSTRAINTS;
DROP TABLE OCUPACION CASCADE CONSTRAINTS;
DROP TABLE CITAS CASCADE CONSTRAINTS;
DROP TABLE DESHAB_PAC CASCADE CONSTRAINTS;
DROP TABLE DESHAB_DOC CASCADE CONSTRAINTS;
DROP TABLE DESHAB_ESP CASCADE CONSTRAINTS;
--**************************

-- INGRESANDO DATOS A LAS TABLAS:
INSERT INTO PLANTAS VALUES(1,'PLANTA BAJA','POR AHI PS');
INSERT INTO PLANTAS VALUES(2,'PLANTA ALTA','MAS ALLA');

INSERT INTO HORARIOS VALUES(1,SYSDATE,SYSDATE);
INSERT INTO HORARIOS VALUES(2,SYSDATE,SYSDATE);
INSERT INTO HORARIOS VALUES(3,SYSDATE,SYSDATE);

INSERT INTO ESPECIALIDAD VALUES(1,'UROLOGIA');
INSERT INTO ESPECIALIDAD VALUES(2,'ESTAMOLOGIA');
INSERT INTO ESPECIALIDAD VALUES(3,'GINECOLOGIA');

INSERT INTO PACIENTES VALUES('75412369','PABLO','NERUDA','AVENIDA SIEMPRE VIVA',999456123,'NO C','MEHH');
INSERT INTO PACIENTES VALUES('78954123','JORGE','QUIÑONES','EL VALCON DEL MAS ALLA',978941123,'LA MEJOR','HIROSHIMA');
INSERT INTO PACIENTES VALUES('65478120','YURI','MILACHAY','LA ISLA TORTUGA',985547412,'CUALQUIERA','RAMPAGE');

INSERT INTO DOCTORES VALUES(1,'75012345','JORGE','VIDAL',1,20);
INSERT INTO DOCTORES VALUES(2,'76987451','JOSE','QUISPE',2,20);
INSERT INTO DOCTORES VALUES(3,'24548150','MOISES','SANCHEZ',3,20);

INSERT INTO HABITACIONES VALUES(1,1,20);
INSERT INTO HABITACIONES VALUES(2,2,15);
INSERT INTO HABITACIONES VALUES(3,1,10);

INSERT INTO CAMAS VALUES(1,1,'A','75412369');
INSERT INTO CAMAS VALUES(2,1,'B','78954123');
INSERT INTO CAMAS VALUES(3,2,'A','65478120');
INSERT INTO CAMAS VALUES(4,1,'A','65478120');

INSERT INTO OCUPACION VALUES(1,1,SYSDATE,TO_DATE('01-07-2017','DD-MM-YYYY'),'75412369');
INSERT INTO OCUPACION VALUES(2,2,SYSDATE,TO_DATE('01-08-2017','DD-MM-YYYY'),'78954123');
INSERT INTO OCUPACION VALUES(3,3,SYSDATE,TO_DATE('01-09-2017','DD-MM-YYYY'),'65478120');

INSERT INTO DIAS VALUES('LUNES',2,2);
INSERT INTO DIAS VALUES('MARTES',3,1);
INSERT INTO DIAS VALUES('MIERCOLES',3,2);
INSERT INTO DIAS VALUES('JUEVES',1,2);
INSERT INTO DIAS VALUES('VIERNES',1,1);
INSERT INTO DIAS VALUES('SABADO',1,3);
INSERT INTO DIAS VALUES('DOMINGO',2,1);

INSERT INTO CITAS VALUES(1,'75412369',1,'SANGRADO DE NARIZ',TO_DATE('01-05-2017','DD-MM-YYYY'),SYSDATE,'EL QUE LE GUSTA COMPA');
INSERT INTO CITAS VALUES(2,'78954123',1,'FRACTURA DE BRAZO',TO_DATE('23-04-2017','DD-MM-YYYY'),SYSDATE,'NO C PS');
INSERT INTO CITAS VALUES(3,'65478120',2,'PARO CARDIACO',TO_DATE('05-02-2017','DD-MM-YYYY'),SYSDATE,'MEEEH');
/*
ID NUMBER(5) PRIMARY KEY NOT NULL,
PACIENTE_DNI VARCHAR2(8),
MEDICO_ID NUMBER(5),
URGENCIA VARCHAR2(30),
FECHA_PROGRAMADA DATE,
FECHA_REGISTRO DATE,
NUMERO_ORDEN VARCHAR2(30)
*/
-- LLAMANDO LAS TABLAS:

SELECT * FROM ESPECIALIDAD;
SELECT * FROM HABITACIONES;
SELECT * FROM DOCTORES;
SELECT * FROM PACIENTES;
SELECT * FROM DIAS;
SELECT * FROM HORARIOS;
SELECT * FROM CITAS;
SELECT * FROM CAMAS;
SELECT * FROM OCUPACION;
SELECT * FROM PLANTAS;
SELECT * FROM DESHAB_PAC;
SELECT * FROM DESHAB_DOC;
SELECT * FROM DESHAB_ESP;


-- BORRANDO DATOS DE LA TABLA
delete from ESPECIALIDAD;
delete from HABITACIONES;
delete from DOCTORES;
delete from PACIENTES;
delete from DIAS;
delete from HORARIOS;
delete from CITAS;
delete from CAMAS;
delete from OCUPACION;
delete from PLANTAS;
delete from DESHAB_PAC;
delete from DESHAB_DOC;

-- CREANDO UN VIEW PARA LA TABLA PACIENTES:
CREATE OR REPLACE VIEW VER_PACIENTES
AS
SELECT DNI,NOMBRES,APELLIDOS,DIRECCION
FROM PACIENTES;


-- ***************************PROCESOS PARA PACIENTES********************************************* 

-- CREANDO PROCESO PARA ACTUALIZAR PACIENTES
create or replace PROCEDURE ACT_PACIENTES(vDNI CHARACTER VARYING,NOM CHARACTER VARYING,
APE CHARACTER VARYING,DIR CHARACTER VARYING,TEL NUMBER,SEG CHARACTER VARYING,MUTU CHARACTER VARYING)
AS 
BEGIN
    UPDATE PACIENTES SET DNI=vDNI , NOMBRES=NOM,APELLIDOS=APE,DIRECCION=DIR,TELEFONO=TEL,SEGURIDAD_SOCIAL=SEG,MUTUALIDAD=MUTU
    WHERE DNI=vDNI;
  NULL;
END ACT_PACIENTES;


-- CREANDO PROCESO PARA DESHABILITAR PACIENTES
create or replace PROCEDURE DESHAB_PACIENTES(vDNI CHARACTER VARYING)
AS 
BEGIN
DELETE FROM PACIENTES
WHERE DNI=vDNI;
END DESHAB_PACIENTES;

-- CREANDO PROCESO PARA HABILITAR PACIENTES 
create or replace PROCEDURE HB_PACIENTES(vDNI CHARACTER VARYING,NOM CHARACTER VARYING,
APE CHARACTER VARYING,DIR CHARACTER VARYING,TEL NUMBER,SEG CHARACTER VARYING,MUTU CHARACTER VARYING) 
AS 
BEGIN
    
    INSERT INTO PACIENTES 
	VALUES (vDNI,NOM, APE, DIR, TEL, SEG,MUTU);
  NULL;
END HB_PACIENTES;

-- CREANDO PROCESO PARA INSERTAR PACIENTES
create or replace PROCEDURE INSERT_PACIENTES(vDNI CHARACTER VARYING,NOM CHARACTER VARYING,
APE CHARACTER VARYING,DIR CHARACTER VARYING,TEL NUMBER,SEG CHARACTER VARYING,MUTU CHARACTER VARYING)
AS 
BEGIN
    INSERT INTO PACIENTES 
	VALUES (vDNI,NOM, APE, DIR, TEL, SEG,MUTU);
  NULL;
END INSERT_PACIENTES;

-- CREANDO PROCESO PARA ELMINAR EN TABLA DESHAB_PACIENTES

CREATE OR REPLACE PROCEDURE INS_DES_PAC(vDNI CHARACTER VARYING)
AS 
BEGIN
    DELETE FROM DESHAB_PAC WHERE DS_DNI=vDNI;
  NULL;
END INS_DES_PAC;


-- ***************************PROCESOS PARA DOCTORES********************************************* 


-- CREANDO PROCESO PARA ACTUALIZAR DOCTORES

create or replace PROCEDURE ACT_DOCTORES(vID NUMBER,vDNI CHARACTER VARYING,
NOM CHARACTER VARYING,APE CHARACTER VARYING,ID_ESP NUMBER,LIM_PAC NUMBER)
AS 
BEGIN
    UPDATE DOCTORES SET ID_DOCTORES=vID , DNI=vDNI, NOMBRES=NOM, APELLIDOS=APE,
    ID_ESPEC=ID_ESP,LIM_PACIENTE=LIM_PAC
    WHERE ID_DOCTORES=vID;
    NULL;
END ACT_DOCTORES;

-- CREANDO PROCESO PARA DESHABILITAR DOCTORES

create or replace PROCEDURE DESHAB_DOCTORES(vID CHARACTER VARYING)
AS 
BEGIN
DELETE FROM DOCTORES
WHERE ID_DOCTORES=vID;
  NULL;
END DESHAB_DOCTORES;

-- CREANDO PROCESO PARA HABILITAR DOCTORES

create or replace PROCEDURE HB_DOCTORES(vID NUMBER,vDNI CHARACTER VARYING,
NOM CHARACTER VARYING,APE CHARACTER VARYING,ID_ESP NUMBER,LIM_PAC NUMBER) 
AS 
BEGIN
    INSERT INTO DOCTORES
	VALUES (vID,vDNI,NOM, APE, ID_ESP,LIM_PAC);
  NULL;
END HB_DOCTORES;

-- CREANDO PROCESO PARA INSERTAR DOCTORES

create or replace PROCEDURE INSERT_DOCTORES(vID NUMBER,vDNI CHARACTER VARYING,
NOM CHARACTER VARYING,APE CHARACTER VARYING,ID_ESP NUMBER,LIM_PAC NUMBER) 
AS 
BEGIN   
    INSERT INTO DOCTORES
	VALUES (vID,vDNI,NOM, APE, ID_ESP,LIM_PAC);
END INSERT_DOCTORES;


-- CREANDO PROCESO PARA BORRAR DOCTORES EN LA TABLA DESHABILITAR DOCTORES

CREATE OR REPLACE PROCEDURE DELETE_DOCTORES(vID CHARACTER VARYING)
AS 
BEGIN
    DELETE FROM DESHAB_DOC WHERE DS_ID_DOCTORES=vID;
  NULL;
END DELETE_DOCTORES;

-- PROCESO PARA INSERTAR DATOS DEL DOCTOR DESHABILITADOS
create or replace PROCEDURE INSERT_DESHAB_DOC(vID NUMBER,vDNI CHARACTER VARYING,
NOM CHARACTER VARYING,APE CHARACTER VARYING,ID_ESP NUMBER,LIM_PAC NUMBER) 
AS 
BEGIN
    INSERT INTO DESHAB_DOC VALUES(vID,vDNI,NOM, APE, ID_ESP,LIM_PAC);
  NULL;
END INSERT_DESHAB_DOC;

-- ************************PROCESOS PARA ESPECIALIDAD****************************

-- PROCESO PARA INSERTAR ESPECIALIDADES

CREATE OR REPLACE PROCEDURE INSERT_ESPECIALIDAD
(vId_espec number,nombre character varying)
AS 
BEGIN
    INSERT INTO ESPECIALIDAD VALUES(vId_espec,nombre);
  NULL;
END INSERT_ESPECIALIDAD;

-- PROCESO PARA ELIMINAR ESPECIALIDADES

CREATE OR REPLACE PROCEDURE DELETE_ESPECIALIDAD(vID_Espec number)
AS 
BEGIN
 DELETE FROM ESPECIALIDAD WHERE ID_ESPECIALIDAD=vID_Espec;
  NULL;
END DELETE_ESPECIALIDAD;

-- PROCESO PARA ELIMINAR ESPECIALIDADES DE LA TABLA DESHABILITAR ESPECIALIDADES

CREATE OR REPLACE PROCEDURE INS_DES_ESP(vID_ESPEC NUMBER)
AS 
BEGIN
    DELETE FROM DESHAB_ESP WHERE DS_ID_ESPECIALIDAD=vID_ESPEC;
  NULL;
END INS_DES_ESP;

-- PROCESO PARA HABILITAR ESPECIALIDADES

CREATE OR REPLACE PROCEDURE HB_ESPECIALIDADES(vID_ESPEC NUMBER,v_NOM_ESP CHARACTER VARYING)
AS 
BEGIN
    INSERT INTO ESPECIALIDAD VALUES(vID_ESPEC,v_NOM_ESP);
  NULL;
END HB_ESPECIALIDADES;


-- ************************PROCESOS PARA CITAS****************************

-- PROCESO PARA INSERTAR CITAS

CREATE OR REPLACE PROCEDURE INSERT_CITAS(vID_CITA NUMBER,vDNI_PACIENTES CHARACTER VARYING,
vDOCTOR_ID NUMBER,vURGENCIA CHARACTER VARYING,vFECHA_PROG CHARACTER VARYING,vFECHA_REG CHARACTER VARYING,
vNUM_ORDEN CHARACTER VARYING)
AS 
BEGIN
    INSERT INTO CITAS VALUES(vID_CITA,vDNI_PACIENTES,vDOCTOR_ID,vURGENCIA,vFECHA_PROG,vFECHA_REG,vNUM_ORDEN);
  NULL;
END INSERT_CITAS;



-- ************************CREACION DE TRIGGERS********************************** 



-- CREANDO TRIGGERS PARA LA TABLA PACIENTES

CREATE OR REPLACE TRIGGER DISP_HAB_PACIENTES 
BEFORE DELETE ON PACIENTES 
FOR EACH ROW
BEGIN
    INSERT INTO DESHAB_PAC VALUES(:OLD.DNI,:OLD.NOMBRES,:OLD.APELLIDOS,:OLD.DIRECCION,:OLD.TELEFONO,:OLD.SEGURIDAD_SOCIAL,:OLD.MUTUALIDAD);
END;

/*
-- OTRO TRIGGER PARA LA TABLA PACIENTES

CREATE OR REPLACE TRIGGER DISP_DESHAB_PACIENTES 
BEFORE INSERT ON PACIENTES 
FOR EACH ROW
BEGIN
    DELETE FROM DESHAB_PAC;
END;
*/

/*
-- CREANDO TRIGGERS PARA LA TABLA DOCTORES

CREATE OR REPLACE TRIGGER DISP_HAB_DOCTORES 
BEFORE DELETE ON DOCTORES 
FOR EACH ROW
BEGIN
    INSERT INTO DESHAB_DOC VALUES(:OLD.ID_DOCTORES,:OLD.DNI,:OLD.NOMBRES,:OLD.APELLIDOS,:OLD.ID_ESPEC,:OLD.LIM_PACIENTE);
END;

-- OTRO TRIGGER PARA LA TABLA DOCTORES

CREATE OR REPLACE TRIGGER DISP_DESHAB_DOCTORES 
BEFORE INSERT ON DOCTORES 
BEGIN
  DELETE FROM DESHAB_DOC;
END;
*/

-- CREANDO DISPARADOR PARA LA TABLA ESPECIALIDADES

CREATE OR REPLACE TRIGGER DISP_HAB_ESPEC 
BEFORE DELETE ON ESPECIALIDAD 
FOR EACH ROW
BEGIN
    INSERT INTO DESHAB_ESP VALUES(:OLD.ID_ESPECIALIDAD,:OLD.NOMBRE_ESP);
  NULL;
END;
